
<!DOCTYPE html>
<html lang="en" style="background: #f2f2f2">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Star Notary</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css">
  <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>

  <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
</head>

<body>

  <!-- Add a Star -->



  <section class="section">

    <div class="container">
      <div class="column">
        <h1 class="title">Star Notary</h1>
        <h2 class="subtitle">Register your Star</h2>
      </div>
    </div>

    <div class="container">

      <div class="columns">
        <div class="column">
          <div class="field">
            <p class="control has-icons-left">
              <input class="input" type="text" placeholder="Star Name" id="star-name" />
              <span class="icon is-small is-left">
                <i class="fas fa-lock"></i>
              </span>
            </p>
          </div>
        </div>
        <div class="is-divider-vertical" data-content="AND"></div>
        <div class="column">
          <div class="field">
            <p class="control has-icons-left">
              <input class="input" type="text" placeholder="Star Story" id="star-story" />
              <span class="icon is-small is-left">
                <i class="fas fa-lock"></i>
              </span>
            </p>
          </div>
        </div>
      </div>

      <div class="container">

        <div class="columns">
          <div class="column">
            <div class="field">
              <p class="control has-icons-left">
                <input class="input" type="text" placeholder="Star RA" id="star-ra" />
                <span class="icon is-small is-left">
                  <i class="fas fa-lock"></i>
                </span>
              </p>
            </div>
          </div>
          <div class="is-divider-vertical" data-content="AND"></div>
          <div class="column">
            <div class="field">
              <p class="control has-icons-left">
                <input class="input" type="text" placeholder="Star DEC" id="star-dec" />
                <span class="icon is-small is-left">
                  <i class="fas fa-lock"></i>
                </span>
              </p>
            </div>
          </div>
          <div class="column">
            <div class="field">
              <p class="control has-icons-left">
                <input class="input" type="text" placeholder="Star MAG" id="star-mag" />
                <span class="icon is-small is-left">
                  <i class="fas fa-lock"></i>
                </span>
              </p>
            </div>
          </div>
        </div>


        <div id="star-answer">
        </div>

        <div class="container">
          <div class="field is-grouped is-grouped-centered">
            <p class="control" style="margin-top: 20px;">
              <a class="button is-primary" id="claim-button" onclick="claimButtonClicked()">
                Submit
              </a>
            </p>
          </div>
        </div>
      </div>



      <hr />

      <!-- Here to check for a Star -->
      <div class="container">
        <div class="column">
          <h2 class="subtitle">Retrieve Star</h2>
        </div>
      </div>

      <div class="container">
        <div class="columns">
          <div class="column">
            <div class="field">
              <p class="control has-icons-left">
                <input class="input" type="text" placeholder="Place your Token" id="star-token" />
                <span class="icon is-small is-left">
                  <i class="fas fa-lock"></i>
                </span>
              </p>

              <div class="field is-grouped ">
                <p class="control" style="margin-top: 30px;">
                  <a class="button is-primary" id="check-button" onclick="checkStarByTx()">
                    Retrieve Star Data
                  </a>
                </p>
              </div>
            </div>
          </div>
          <div class="is-divider-vertical" data-content="AND"></div>
          <div class="column">
          </div>
        </div>
      </div>



      <div class="container">
        <div class="columns">
          <div class="column">
            <div class="field">
              <div id="star-show"></div>
            </div>
          </div>
          <div class="is-divider-vertical" data-content="AND"></div>
          <div class="column">
          </div>
        </div>
      </div>

    </div>

  </section>

  <script>
  if (typeof web3 !== 'undefined') {
  web3 = new Web3(web3.currentProvider);
} else {
  // set the provider you want from Web3.providers
  web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:8545'));
}

// The default (top) wallet account from a list of test accounts
//web3.eth.defaultAccount = web3.eth.accounts[0];
web3.eth.getAccounts(function(error, accounts) {
  web3.eth.defaultAccount = web3.eth.accounts[0];
});
console.log(web3.eth.defaultAccount);
//web3.eth.getAccounts().then(e => console.log(e));

// The interface definition for your smart contract (the ABI)
// build/contracts/StarNotary.json > abi property
var StarNotary = web3.eth.contract([
  {
    constant: true,
    inputs: [
      {
        name: 'interfaceId',
        type: 'bytes4'
      }
    ],
    name: 'supportsInterface',
    outputs: [
      {
        name: '',
        type: 'bool'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0x01ffc9a7'
  },
  {
    constant: true,
    inputs: [
      {
        name: '',
        type: 'uint256'
      }
    ],
    name: 'starsForSale',
    outputs: [
      {
        name: '',
        type: 'uint256'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0x0564b130'
  },
  {
    constant: true,
    inputs: [],
    name: 'tokenAt',
    outputs: [
      {
        name: '',
        type: 'uint256'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0x058df07b'
  },
  {
    constant: true,
    inputs: [],
    name: 'name',
    outputs: [
      {
        name: '',
        type: 'string'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0x06fdde03'
  },
  {
    constant: true,
    inputs: [
      {
        name: 'tokenId',
        type: 'uint256'
      }
    ],
    name: 'getApproved',
    outputs: [
      {
        name: '',
        type: 'address'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0x081812fc'
  },
  {
    constant: false,
    inputs: [
      {
        name: 'to',
        type: 'address'
      },
      {
        name: 'tokenId',
        type: 'uint256'
      }
    ],
    name: 'approve',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
    signature: '0x095ea7b3'
  },
  {
    constant: false,
    inputs: [
      {
        name: 'from',
        type: 'address'
      },
      {
        name: 'to',
        type: 'address'
      },
      {
        name: 'tokenId',
        type: 'uint256'
      }
    ],
    name: 'transferFrom',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
    signature: '0x23b872dd'
  },
  {
    constant: false,
    inputs: [
      {
        name: 'from',
        type: 'address'
      },
      {
        name: 'to',
        type: 'address'
      },
      {
        name: 'tokenId',
        type: 'uint256'
      }
    ],
    name: 'safeTransferFrom',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
    signature: '0x42842e0e'
  },
  {
    constant: true,
    inputs: [
      {
        name: 'tokenId',
        type: 'uint256'
      }
    ],
    name: 'ownerOf',
    outputs: [
      {
        name: '',
        type: 'address'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0x6352211e'
  },
  {
    constant: true,
    inputs: [
      {
        name: 'owner',
        type: 'address'
      }
    ],
    name: 'balanceOf',
    outputs: [
      {
        name: '',
        type: 'uint256'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0x70a08231'
  },
  {
    constant: true,
    inputs: [],
    name: 'symbol',
    outputs: [
      {
        name: '',
        type: 'string'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0x95d89b41'
  },
  {
    constant: false,
    inputs: [
      {
        name: 'to',
        type: 'address'
      },
      {
        name: 'approved',
        type: 'bool'
      }
    ],
    name: 'setApprovalForAll',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
    signature: '0xa22cb465'
  },
  {
    constant: true,
    inputs: [
      {
        name: '',
        type: 'bytes32'
      }
    ],
    name: 'unique',
    outputs: [
      {
        name: '',
        type: 'bool'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0xa98d03b2'
  },
  {
    constant: false,
    inputs: [
      {
        name: 'from',
        type: 'address'
      },
      {
        name: 'to',
        type: 'address'
      },
      {
        name: 'tokenId',
        type: 'uint256'
      },
      {
        name: '_data',
        type: 'bytes'
      }
    ],
    name: 'safeTransferFrom',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
    signature: '0xb88d4fde'
  },
  {
    constant: true,
    inputs: [
      {
        name: 'tokenId',
        type: 'uint256'
      }
    ],
    name: 'tokenURI',
    outputs: [
      {
        name: '',
        type: 'string'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0xc87b56dd'
  },
  {
    constant: true,
    inputs: [
      {
        name: 'owner',
        type: 'address'
      },
      {
        name: 'operator',
        type: 'address'
      }
    ],
    name: 'isApprovedForAll',
    outputs: [
      {
        name: '',
        type: 'bool'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0xe985e9c5'
  },
  {
    inputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'constructor',
    signature: 'constructor'
  },
  {
    anonymous: false,
    inputs: [
      {
        indexed: true,
        name: 'from',
        type: 'address'
      },
      {
        indexed: true,
        name: 'to',
        type: 'address'
      },
      {
        indexed: true,
        name: 'tokenId',
        type: 'uint256'
      }
    ],
    name: 'Transfer',
    type: 'event',
    signature:
      '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef'
  },
  {
    anonymous: false,
    inputs: [
      {
        indexed: true,
        name: 'owner',
        type: 'address'
      },
      {
        indexed: true,
        name: 'approved',
        type: 'address'
      },
      {
        indexed: true,
        name: 'tokenId',
        type: 'uint256'
      }
    ],
    name: 'Approval',
    type: 'event',
    signature:
      '0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925'
  },
  {
    anonymous: false,
    inputs: [
      {
        indexed: true,
        name: 'owner',
        type: 'address'
      },
      {
        indexed: true,
        name: 'operator',
        type: 'address'
      },
      {
        indexed: false,
        name: 'approved',
        type: 'bool'
      }
    ],
    name: 'ApprovalForAll',
    type: 'event',
    signature:
      '0x17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c31'
  },
  {
    constant: false,
    inputs: [
      {
        name: 'starName',
        type: 'string'
      },
      {
        name: 'starStory',
        type: 'string'
      },
      {
        name: 'ra',
        type: 'string'
      },
      {
        name: 'dec',
        type: 'string'
      },
      {
        name: 'mag',
        type: 'string'
      }
    ],
    name: 'createStar',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
    signature: '0x5f3ff33c'
  },
  {
    constant: true,
    inputs: [
      {
        name: 'tokenId',
        type: 'uint256'
      }
    ],
    name: 'tokenIdToStarInfo',
    outputs: [
      {
        name: '',
        type: 'string'
      },
      {
        name: '',
        type: 'string'
      },
      {
        name: '',
        type: 'string'
      },
      {
        name: '',
        type: 'string'
      },
      {
        name: '',
        type: 'string'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0x1967fd98'
  },
  {
    constant: true,
    inputs: [
      {
        name: 'coordinates',
        type: 'bytes32'
      }
    ],
    name: 'checkIfStarExist',
    outputs: [
      {
        name: '',
        type: 'bool'
      }
    ],
    payable: false,
    stateMutability: 'view',
    type: 'function',
    signature: '0x253d6390'
  },
  {
    constant: true,
    inputs: [
      {
        name: 'ra',
        type: 'string'
      },
      {
        name: 'dec',
        type: 'string'
      },
      {
        name: 'mag',
        type: 'string'
      }
    ],
    name: 'coordinatesToHash',
    outputs: [
      {
        name: '',
        type: 'bytes32'
      }
    ],
    payable: false,
    stateMutability: 'pure',
    type: 'function',
    signature: '0xa2d1d2d1'
  },
  {
    constant: false,
    inputs: [
      {
        name: 'tokenId',
        type: 'uint256'
      },
      {
        name: 'price',
        type: 'uint256'
      }
    ],
    name: 'putStarUpForSale',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
    signature: '0x316a4361'
  },
  {
    constant: false,
    inputs: [
      {
        name: 'tokenId',
        type: 'uint256'
      }
    ],
    name: 'buyStar',
    outputs: [],
    payable: true,
    stateMutability: 'payable',
    type: 'function',
    signature: '0x2f1c34ef'
  },
  {
    constant: false,
    inputs: [
      {
        name: 'tokenId',
        type: 'uint256'
      }
    ],
    name: 'mint',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
    signature: '0xa0712d68'
  },
  {
    constant: false,
    inputs: [
      {
        name: 'starOwner',
        type: 'address'
      },
      {
        name: 'to',
        type: 'address'
      },
      {
        name: 'tokenId',
        type: 'uint256'
      }
    ],
    name: 'transferStar',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
    signature: '0x37706d0c'
  },
  {
    constant: false,
    inputs: [
      {
        name: 'user1',
        type: 'address'
      },
      {
        name: 'user1TokenId',
        type: 'uint256'
      },
      {
        name: 'user2',
        type: 'address'
      },
      {
        name: 'user2TokenId',
        type: 'uint256'
      }
    ],
    name: 'exchangeStars',
    outputs: [],
    payable: false,
    stateMutability: 'nonpayable',
    type: 'function',
    signature: '0x40f5ec88'
  }
]);
// Grab the contract at specified deployed address with the
// interface defined by the ABI
var starNotary = StarNotary.at('0xF7c71e77b4E0670019D4e4C89Be877428A25489d');

// Enable claim button being clicked

// Star copyright: https://d1jqu7g1y74ds1.cloudfront.net/wp-content/uploads/2010/08/The-Brightest-of-Stars.jpg
const star = 'images/star.jpg';

function claimButtonClicked() {
  web3.eth.getAccounts(function(error, accounts) {
    if (error) {
      console.log(error);
      return;
    }

    var account = accounts[0];
    const name = document.querySelector('#star-name').value;
    const story = document.querySelector('#star-story').value;
    const ra = document.querySelector('#star-ra').value;
    const dec = document.querySelector('#star-dec').value;
    const mag = document.querySelector('#star-mag').value;

    starNotary.createStar.sendTransaction(name, story, ra, dec, mag, function(
      error,
      result
    ) {
      document.querySelector('#star-answer').innerHTML =
        '<b>Loading...</b> Please wait...!';

      if (!error) {
        document.querySelector('#star-answer').innerHTML =
          '<article class="media"><figure class="media-left"><p class="image is-64x64"><img src="' +
          star +
          '"></p></figure><div class="media-content"><div class="content"><p><strong>' +
          name +
          '</strong> <small>@johnsmith</small> <small>31m</small><br>Great!</b>Check your transaction here <a href="https://rinkeby.etherscan.io/tx/' +
          result +
          '">' +
          result +
          '</a></p></div><div></article>';

        '<b>Great!</b> Check your transaction here <a href="https://rinkeby.etherscan.io/tx/' +
          result +
          '">' +
          result +
          '</a>';

        var starClaimedEvent = starNotary.Transfer({ from: account });
        starClaimedEvent.watch(function(error, result) {
          console.log(result);
          if (!error) {
            console.log('If I see this Tx should be done!');
            //location.reload();
          } else {
            console.log('watching for star claimed event is failing');
          }
        });
      } else {
        console.log(error);
      }
    });
  });
}

function checkStarByTx() {
  web3.eth.getAccounts(function(error, accounts) {
    if (error) {
      console.log(error);
      return;
    }
    var account = accounts[0];
    const tokenId = document.querySelector('#star-token').value;
    if (tokenId == '' || tokenId == ' ') {
      alert('Token should be something...!');
      return;
    }

    document.querySelector('#star-show').innerHTML =
      '<b>Loading...</b> Please wait...!';

    starNotary.tokenIdToStarInfo.call(tokenId, function(error, result) {
      if (!error) {
        if (!result[0]) {
          document.querySelector('#star-show').innerHTML =
            '<b>Please, provide a valid token</b>';
          return;
        }
        let starResponse =
          '<div class="card"> <div class="card-image"> <figure class="image is-4by3"> <img src="/' +
          star +
          '" alt="' +
          result[0] +
          '"> </figure> </div> <div class="card-content"> <div class="media"> <div class="media-left"> <figure class="image is-48x48"> <img src="' +
          star +
          '" alt="' +
          result[0] +
          '"> </figure> </div> <div class="media-content"> <p class="title is-4">' +
          result[0] +
          '</p> <p class="subtitle is-6">@johnsmith</p> </div> </div> <div class="content"> Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus nec iaculis mauris. <a>@bulmaio</a>. <a href="#">#css</a> <a href="#">#responsive</a> <br> <time datetime="2016-1-1">11:09 PM - 1 Jan 2016</time> </div> </div> </div>';

        //console.log(starResponse);
        document.querySelector('#star-show').innerHTML = starResponse;
      } else {
        console.log(error);
      }
    });
  });

  /*
    
    '<b>Name:</b> ' +
    result[0] +
    '<br /><b>Story:</b> ' +
    result[1] +
    '<br /><b>Coordinates</b><br /><b>RA:</b> ' +
    result[2] +
    '<br /><b>DEC:</b> ' +
    result[3] +
    '<br /><b>MAG:</b> ' +
    result[4];
    */
}
</script>
</body>
</html>
